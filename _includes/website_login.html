<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f2f2f2;
      margin: 0;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }

    .container {
      background-color: #ffffff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      max-width: 400px;
      width: 100%;
      text-align: center;
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: #333;
    }

    input {
      width: 100%;
      padding: 10px;
      margin-bottom: 16px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    button {
      background-color: #4caf50;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }

    button:hover {
      background-color: #45a049;
    }
  </style>
  <title>Login and Sign Up</title>
</head>
<body>
  <div class="container" id="login">
    <form id="login-form">
      <div class="imgcontainer">
        <img src="images/login-image.png" alt="LoginImage" class="loginimage">
      </div>
    
      <label for="uname"><b>Username</b></label>
      <input type="text" placeholder="Enter Username" name="username" required id="username-field">
  
      <label for="psw"><b>Password</b></label>
      <input type="password" placeholder="Enter Password" name="password" required id="password-field">
      
      <button id="login-form-submit">Login</button>
    </form>

    <div style="margin-top: 20px;">
      <button onclick="showSignUpForm()" style="width: 100%;">Sign Up</button>
      <p class="psw">Authorized: <span id="myText"></span></p>
    </div>
  </div>

  <div class="container" id="id01" style="display: none;">
    <form class="modal-content" id="signup-form">
      <h1>Sign Up</h1>
      <p>Enter your personalized details.</p>
      <hr>

      <label for="newusername"><b>Username</b></label>
      <input type="text" placeholder="Enter Username" name="usn" required>
    
      <label for="psw"><b>Password</b></label>
      <input type="password" placeholder="Enter Password" name="psw" required>
    
      <label for="psw-repeat"><b>Repeat Password</b></label>
      <input type="password" placeholder="Repeat Password" name="psw-repeat" required>
      
      <div class="clearfix">
        <div class="clearfix">
          <button type="button" onclick="hideSignUpForm()" class="cancelbtn">Cancel</button>
          <button type="submit" class="signupbtn" id="signup-form-submit">Sign Up</button>
        </div>
      </form>
    </div>

    <script>
      function showSignUpForm() {
        // Hide the login form
        document.getElementById('login').style.display = 'none';
        // Show the sign-up form
        document.getElementById('id01').style.display = 'block';
      }
  
      function hideSignUpForm() {
        // Show the login form
        document.getElementById('login').style.display = 'block';
        // Hide the sign-up form
        document.getElementById('id01').style.display = 'none';
      }
    </script>
  
    <script>
    let authtoken = window.sessionStorage.getItem("authtoken");
    var authorize = "false"
    document.getElementById("myText").innerHTML = authorize;
    authorizeAPI("id","username","password");
  
    async function authorizeAPI(id, username, password) {
      const response3 = await fetch('http://127.0.0.1:8086/authorize', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ "id":id, "username":username, "password":password }),
      });
  
      const data3 = await response3.json();
      if (response.ok) {
        authorize = "true"
      } else  {
        authorize = "false"
      }  
    }
  
  </script>
  
  <script>
    const loginForm = document.getElementById("login-form");
      const loginButton = document.getElementById("login-form-submit");
      const loginErrorMsg = document.getElementById("login-error-msg");
  
      loginButton.addEventListener("click", (e) => {
          e.preventDefault();
          const username = loginForm.username.value;
          const password = loginForm.password.value;
  
          loginUser(username, password)
      })
  
      async function loginUser(username, password) {
        const response = await fetch('http://127.0.0.1:8086/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ "username":username, "password":password }),
        });
      
        const data = await response.json();
        if (response.ok) {
          alert("You have successfully logged in.");
          hideSignUpForm();
          window.location.replace("/login-redirect/")
          document.getElementById('login').style.display = 'block';
        } else if (response.status === 401) {
          alert("You have entered the wrong username and/or password. Please try again.");
        } else if (response.status === 403) {
          alert("You have entered the wrong username and/or password. Please try again.");
        } else if (response.status === 404) {
          alert("You have entered the wrong username and/or password. Please try again.");
        }
      }
  
  </script>
  
  
  <script>
    // Get the modal
    var modal = document.getElementById('id01');
    
    // When the user clicks anywhere outside of the modal, close it
  //  window.onclick = function(event) {
   //   if (event.target == modal) {
   //     modal.style.display = "none";
   //   }
   // }
  
    const signupForm = document.getElementById("signup-form");
    const signupButton = document.getElementById("signup-form-submit");
  
    signupButton.addEventListener("click", (e) => {
      e.preventDefault();
      const username = signupForm.usn.value;
      const password = signupForm.psw.value;
  
      signup(username, password)
    })
    async function signup(username, password) {
      const response2 = await fetch('http://127.0.0.1:8086/signUp', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ "username": username, "password": password }),
      });
    
      if (response2.ok) {
        const data2 = await response2.json();
        alert("User created successfully: " + JSON.stringify(data2));
        modal.style.display = "none";
      } else {
        alert("Error creating user. Status code: " + response2.status);
        const errorData = await response2.json();
        console.error("Error details:", errorData);
      }
    }    
    </script>